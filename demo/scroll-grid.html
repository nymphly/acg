<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <style>
    html,
    body,
    #container {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
  <script src='./../dist/bundle.js'>
  </script>
</head>

<body>
  <div id="container"></div>
</body>

<script>
  const WIDTH = 900;
  const HEIGHT = 600;
  const CELL_HEIGHT = 30;
  const CELL_WIDTH = 30;

  const config = {
    tag: 'svg',
    name: 'Svg',
    attrs: {
      xmlns: 'http://www.w3.org/2000/svg',
      border: 0,
      width: '100%',
      height: '100%',
      class: 'anychart-ui-support',
      style: 'display: block',
    },
    content: [
      {
        tag: 'defs',
        name: 'Defs',
        content: [
          {
            tag: 'linearGradient',
            name: 'Black-To-White',
            attrs: {
              'id:uid': '', // TODO uid command generates UID, ignores '' value.
              x1: 0,
              y1: 0.5,
              x2: 1,
              y2: 0.5,
              gradientUnits: 'objectBoundingBox',
            },
            content: [
              {
                tag: 'stop',
                name: 'First-Stop',
                attrs: {
                  offset: 0,
                  style: 'stop-color:#ffffff; stop-opacity:1',
                },
              },

              {
                tag: 'stop',
                name: 'Second-Stop',
                attrs: {
                  offset: 1,
                  style: 'stop-color:#000000; stop-opacity:1',
                },
              },
            ],
          },
        ],
      },

      {
        tag: 'g',
        name: 'Root',
        content: [
          {
            tag: 'path',
            name: 'Border',
            attrs: {
              fill: 'none',
              stroke: '#0f0',
              'stroke-opacity': '100%',
              'stroke-width': 1,
              d: 'M 0 0',
            },
          },
        ],
      },
    ],
  };

  const t0 = Date.now();
  const stage = acg.create(config);
  const container = document.getElementById('container');
  stage.container = container;
  stage.render();
  console.log(`Render time: ${Date.now() - t0}ms`);


  let offX = 0;
  let offY = 0;
  let dragging = false;

  const pather = acg.pather().setShift(0.5);
  const border = stage.find('Border');

  function drawState(x = 0, y = 0) {
    console.log('Drawing!!!');
    pather.clear();
    let currX = x;
    let currY = y;
    while (currX <= WIDTH) {
      pather.moveTo(currX, 0).v(HEIGHT);
      currX += CELL_WIDTH;
    }

    while (currY <= HEIGHT) {
      pather.moveTo(0, currY).h(WIDTH);
      currY += CELL_HEIGHT;
    }
    pather.applyTo(border);
    stage.render();
  }

  drawState();


  container.addEventListener('mousewheel', (e) => {
    e.preventDefault();

    const dX = e.deltaX % CELL_WIDTH;
    const dY = e.deltaY % CELL_HEIGHT;
    offX -= dX;
    offY -= dY;

    drawState(offX % CELL_WIDTH, offY % CELL_HEIGHT);
  });

  // container.addEventListener('mousedown', (e) => {
  //   dragging = true;
  // });

  // document.addEventListener('mousemove', (e) => {
  //   if (dragging) {
  //     console.log(e);
  //   }
  // });

  // document.addEventListener('mouseup', (e) => {
  //   if (dragging) {
  //     console.log(e);
  //   }
  //   dragging = false;
  // });

</script>

</html>